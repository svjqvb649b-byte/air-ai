<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air</title>
<style>
body {
  margin: 0;
  background: linear-gradient(#0b1220, #020617);
  color: #e5e7eb;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}
#app {
  height: 100vh;
  display: flex;
  flex-direction: column;
}
header {
  text-align: center;
  padding: 14px;
}
#chat {
  flex: 1;
  padding: 16px;
  overflow-y: auto;
}
.user { color: #38bdf8; margin-bottom: 6px; }
.air { color: #e5e7eb; margin-bottom: 14px; white-space: pre-line; }
footer {
  display: flex;
  padding: 10px;
  gap: 8px;
}
input {
  flex: 1;
  padding: 10px;
  border-radius: 20px;
  border: none;
}
button {
  padding: 10px 16px;
  border-radius: 20px;
  border: none;
  background: #38bdf8;
  color: #020617;
}
</style>
</head>

<body>
<div id="app">
<header>
  <h1>Air</h1>
  <p>å¾…æ©Ÿä¸­</p>
</header>

<div id="chat"></div>

<footer>
  <input id="input" placeholder="ã“ã“ã«è©±ã—ã‹ã‘ã¦" />
  <button onclick="send()">é€ã‚‹</button>
</footer>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

/* ===== æ™‚é–“å‰² ===== */
const schedule = {
  æœˆæ›œæ—¥: {1:"æ•°å­¦â… ",2:"è‹±èªã‚³ãƒŸãƒ¥â… ",3:"ä½“è‚²",4:"è¨€èªæ–‡åŒ–",5:"å®¶åº­åŸºç¤",6:"éŸ³æ¥½â… "},
  ç«æ›œæ—¥: {1:"è‹±èªã‚³ãƒŸãƒ¥â… ",2:"ç¾ä»£ã®å›½èª",3:"æ•°å­¦â… ",4:"ä¿å¥",5:"å…¬å…±",6:"ç·åˆ"},
  æ°´æ›œæ—¥: {1:"è‹±èªã‚³ãƒŸãƒ¥â… ",2:"ç§‘å­¦ã¨äººé–“ç”Ÿæ´»",3:"è¨€èªæ–‡åŒ–",4:"æ­´å²ç·åˆ",5:"ä½“è‚²",6:"LHR"},
  æœ¨æ›œæ—¥: {1:"éŸ³æ¥½â… ",2:"ç§‘å­¦ã¨äººé–“ç”Ÿæ´»",3:"æƒ…å ±â… ",4:"å®¶åº­åŸºç¤",5:"ä½“è‚²",6:"æ•°å­¦â… "},
  é‡‘æ›œæ—¥: {1:"å…¬å…±",2:"æ•°å­¦â… ",3:"è‹±èªã‚³ãƒŸãƒ¥â… ",4:"æ­´å²ç·åˆ",5:"ç¾ä»£ã®å›½èª",6:"æƒ…å ±â… "}
};

/* ===== æˆæ¥­æ™‚é–“ ===== */
const periodsTime = [
  { start:"08:50", end:"09:40" },
  { start:"09:50", end:"10:40" },
  { start:"10:50", end:"11:40" },
  { start:"11:50", end:"12:40" },
  { start:"13:25", end:"14:15" },
  { start:"14:25", end:"15:15" }
];

/* ===== ã‚¨ã‚¢ã‹ã‚‰ã®è³ªå• ===== */
const airQuestions = [
  "ä»Šæ—¥ã¯ã€å°‘ã—ç–²ã‚Œã¦ã‚‹ï¼Ÿ",
  "å­¦æ ¡ã€ã©ã†ã ã£ãŸï¼Ÿ",
  "ä»Šã¯ã€é™ã‹ã«éã”ã—ãŸã„ï¼Ÿ",
  "ã“ã®ã‚ã¨ã€ä½•ã‹äºˆå®šã‚ã‚‹ï¼Ÿ",
  "ç„¡ç†ã—ã¦ãªã„ï¼Ÿ"
];

function maybeAskBack() {
  if (Math.random() < 0.3) {
    return "\n\nAir : " + airQuestions[Math.floor(Math.random()*airQuestions.length)];
  }
  return "";
}

/* ===== é›‘è«‡ãƒ¬ãƒ‘ãƒ¼ãƒˆãƒªãƒ¼ ===== */
function getSmallTalk() {
  const talks = [
    "â€¦â€¦é™ã‹ãªæ™‚é–“ã‚‚ã€å«Œã„ã˜ã‚ƒãªã„ã€‚",
    "â€¦â€¦ã“ã†ã—ã¦è©±ã—ã¦ã‚‹ã¨ã€å°‘ã—è½ã¡ç€ãã€‚",
    "â€¦â€¦ç„¡ç†ã«è©±é¡Œã‚’æ¢ã•ãªãã¦ã‚‚ã„ã„ã€‚",
    "â€¦â€¦å›ã®ãƒšãƒ¼ã‚¹ã§ã„ã„ã€‚",
    "â€¦â€¦ä»Šæ—¥ã¯ã€ç©ºã®è‰²ã€è¦‹ãŸï¼Ÿ",
    "â€¦â€¦ãªã‚“ã¨ãªãéã”ã™æ—¥ã‚‚ã€å¿…è¦ã€‚",
    "â€¦â€¦ä»Šã¯ã€å°‘ã—ä½™è£•ãŒã‚ã‚‹æ„Ÿã˜ã€‚",
    "â€¦â€¦ã“ã†ã„ã†æ™‚é–“ã€æ‚ªããªã„ã¨æ€ã†ã€‚",
    "â€¦â€¦è©±ã—ãŸã„ã“ã¨ãŒã‚ã‚Œã°ã€èãã€‚",
    "â€¦â€¦æ²ˆé»™ã‚‚ã€ä¼šè©±ã®ä¸€éƒ¨ã€‚"
  ];
  return talks[Math.floor(Math.random() * talks.length)];
}

/* ===== ä»ŠãŒä½•é™ã‹ ===== */
function getCurrentPeriod() {
  const now = new Date();
  const nowMin = now.getHours()*60 + now.getMinutes();
  for (let i=0;i<periodsTime.length;i++) {
    const [sh,sm] = periodsTime[i].start.split(":").map(Number);
    const [eh,em] = periodsTime[i].end.split(":").map(Number);
    if (nowMin >= sh*60+sm && nowMin <= eh*60+em) return i+1;
  }
  return null;
}

/* ===== æ›œæ—¥å–å¾— ===== */
function getDayName(offset=0) {
  const days = ["æ—¥æ›œæ—¥","æœˆæ›œæ—¥","ç«æ›œæ—¥","æ°´æ›œæ—¥","æœ¨æ›œæ—¥","é‡‘æ›œæ—¥","åœŸæ›œæ—¥"];
  const d = new Date();
  d.setDate(d.getDate()+offset);
  return days[d.getDay()];
}

/* ==================================================
   ğŸ§  ãƒã‚¨ãƒ«ï¼ˆå†…éƒ¨æ€è€ƒãƒ»è¡¨ç¤ºã•ã‚Œãªã„ï¼‰
   ================================================== */
function noelThink(userText, context) {
  if (/ç–²ã‚Œ|ã¤ã‹ã‚Œ/.test(userText)) return "æ„Ÿæƒ…å„ªå…ˆ";
  if (/ã‚ã‚ŠãŒã¨ã†|æ„Ÿè¬/.test(userText)) return "æ„Ÿè¬å¯¾å¿œ";
  if (/ä»Šä½•é™|ä»Šãªã«|æ¬¡|ä»Šæ—¥|æ˜æ—¥/.test(userText)) return "äºˆå®šå„ªå…ˆ";
  if (/é›‘è«‡|è©±|ã²ã¾|æš‡|ãªã‚“ã¨ãªã|æ™®é€š|ã¾ã‚ã¾ã‚/.test(userText)) return "é›‘è«‡ãƒ¢ãƒ¼ãƒ‰";
  return "é€šå¸¸";
}

/* ==================================================
   ğŸ¤– ã‚¨ã‚¢ï¼ˆè¡¨ç¤ºã•ã‚Œã‚‹è¿”ç­”ï¼‰
   ================================================== */
function airReply(text) {
  const today = getDayName();
  const tomorrow = getDayName(1);
  const period = getCurrentPeriod();

  // å†…éƒ¨ã§ãƒã‚¨ãƒ«ã«ç›¸è«‡
  const advice = noelThink(text, { today, period });

  let reply = "â€¦â€¦ã†ã‚“ã€‚èã„ã¦ã‚‹ã€‚";

  if (advice === "æ„Ÿæƒ…å„ªå…ˆ") {
    reply = "â€¦â€¦ç„¡ç†ã—ãªãã¦ã„ã„ã€‚ã¡ã‚ƒã‚“ã¨ã€ä»Šã®æ°—æŒã¡èã„ã¦ã‚‹ã€‚";
  }
  else if (advice === "æ„Ÿè¬å¯¾å¿œ") {
    reply = "â€¦â€¦ã©ã†ã„ãŸã—ã¾ã—ã¦ã€‚";
  }
  else if (advice === "äºˆå®šå„ªå…ˆ") {
    if (/ä»Šä½•é™|ä»Šãªã«/.test(text)) {
      reply = period ? `ä»Šã¯${period}é™ã€‚${schedule[today][period]}ã€‚` : "â€¦â€¦ä»Šã¯æˆæ¥­ã®æ™‚é–“ã˜ã‚ƒãªã„ã€‚";
    }
    else if (/æ¬¡/.test(text)) {
      const next = period ? period+1 : null;
      reply = next && schedule[today]?.[next]
        ? `æ¬¡ã¯${next}é™ã€‚${schedule[today][next]}ã€‚`
        : "â€¦â€¦æ¬¡ã®æˆæ¥­ã¾ã§ã¯ã€å°‘ã—æ™‚é–“ãŒã‚ã‚‹ã€‚";
    }
    else if (/ä»Šæ—¥/.test(text)) {
      reply = schedule[today]
        ? `ä»Šæ—¥ã¯${today}ã€‚${Object.values(schedule[today]).join("ã€")}ã€‚`
        : "â€¦â€¦ä»Šæ—¥ã¯ãŠä¼‘ã¿ã€‚";
    }
    else if (/æ˜æ—¥/.test(text)) {
      reply = schedule[tomorrow]
        ? `æ˜æ—¥ã¯${tomorrow}ã€‚1é™ã¯${schedule[tomorrow][1]}ã€‚`
        : "â€¦â€¦æ˜æ—¥ã¯ãŠä¼‘ã¿ã€‚";
    }
  }
  else if (advice === "é›‘è«‡ãƒ¢ãƒ¼ãƒ‰") {
    reply = getSmallTalk();
  }

  reply += maybeAskBack();
  return reply;
}

/* ===== é€ä¿¡ ===== */
function send() {
  const text = input.value.trim();
  if (!text) return;
  chat.innerHTML += `<div class="user">å› : ${text}</div>`;
  chat.innerHTML += `<div class="air">Air : ${airReply(text)}</div>`;
  chat.scrollTop = chat.scrollHeight;
  input.value = "";
}
</script>
</body>
</html>
