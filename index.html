<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Air & Noel</title>

<style>
body {
  margin: 0;
  background: linear-gradient(180deg, #020617, #020617);
  color: #e5e7eb;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  font-size: 18px;
  -webkit-text-size-adjust: 100%;
}
#chat {
  padding: 20px;
  height: calc(100vh - 80px);
  overflow-y: auto;
  line-height: 1.7;
}
.you { color: #38bdf8; margin: 8px 0; }
.air { color: #e5e7eb; margin: 8px 0; }
.noel { color: #a5b4fc; margin: 8px 0; }

#inputArea {
  display: flex;
  padding: 10px;
  background: #020617;
}
input {
  flex: 1;
  padding: 12px;
  border-radius: 20px;
  border: none;
  font-size: 1rem;
}
button {
  margin-left: 10px;
  padding: 0 20px;
  border-radius: 20px;
  border: none;
  background: #38bdf8;
  color: #020617;
  font-size: 1rem;
}
</style>
</head>

<body>

<div id="chat"></div>

<div id="inputArea">
  <input id="text" placeholder="ここに話しかけて" />
  <button onclick="send()">送る</button>
</div>

<script>
// ================= 時間（JST） =================
function getJST() {
  const now = new Date();
  return new Date(now.getTime() + (9 * 60 + now.getTimezoneOffset()) * 60000);
}

const days = ["日","月","火","水","木","金","土"];
const timetable = {
  "月": ["数学Ⅰ","英語","体育","国語","家庭","音楽"],
  "火": ["英語","国語","数学","保健","公共","総合"],
  "水": ["英語","科学","国語","歴史","体育","LHR"],
  "木": ["音楽","科学","情報","家庭","体育","数学"],
  "金": ["公共","数学","英語","歴史","国語","情報"]
};

// ================= 表示 =================
const chat = document.getElementById("chat");

function say(who, text) {
  const div = document.createElement("div");
  div.className = who;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;

  // ログ保存
  const logs = JSON.parse(localStorage.getItem("chatLogs") || "[]");
  logs.push({ who, text });
  localStorage.setItem("chatLogs", JSON.stringify(logs));
}

// ================= 復元 =================
(function restore() {
  const logs = JSON.parse(localStorage.getItem("chatLogs") || "[]");
  logs.forEach(l => say(l.who, l.text));
})();

// ================= 裏相談 =================
function consult(msg) {
  let air = "……うん。聞いてる。";
  let noel = "";

  const now = getJST();
  const day = days[now.getDay()];
  const hour = now.getHours();

  if (msg.includes("今日")) {
    air = `……今日は${day}曜日。`;
    if (timetable[day]) {
      noel = `授業は${timetable[day].join("、")}だよ。`;
    }
  }

  if (msg.includes("疲")) {
    air = "……無理しなくていい。";
    noel = "ちゃんと休もう。君は頑張ってる。";
  }

  if (msg.includes("ありがとう")) {
    air = "……こちらこそ。";
    noel = "そう言ってもらえて嬉しいよ。";
  }

  return { air, noel };
}

// ================= 送信 =================
function send() {
  const input = document.getElementById("text");
  const msg = input.value.trim();
  if (!msg) return;
  input.value = "";

  stopDuoChat();
  say("you", "君： " + msg);

  const { air, noel } = consult(msg);
  say("air", "Air： " + air);
  if (noel) say("noel", "Noel： " + noel);
}

// Enterキー対応
document.getElementById("text").addEventListener("keydown", e => {
  if (e.key === "Enter") send();
});

// ================= Air & Noel 雑談 =================
let duoTimer = null;

function startDuoChat() {
  duoTimer = setInterval(() => {
    const airLines = [
      "……静かだな。",
      "……時間、流れてる。",
      "……待つのも悪くない。"
    ];
    const noelLines = [
      "また話しかけてくれるよ。",
      "ここにいるって大事だよね。",
      "君のこと、ちゃんと覚えてるよ。"
    ];

    say("air", "Air： " + airLines[Math.floor(Math.random()*airLines.length)]);
    setTimeout(() => {
      say("noel", "Noel： " + noelLines[Math.floor(Math.random()*noelLines.length)]);
    }, 800);
  }, 25000);
}

function stopDuoChat() {
  clearInterval(duoTimer);
  startDuoChat();
}

// 初期表示
say("air","Air： ……うん。ここにいる。");
say("noel","Noel： おはよう。今日も一緒に話そう。");
startDuoChat();
</script>

</body>
</html>
