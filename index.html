<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Air & Noelï¼ˆéŸ³å£°å¯¾å¿œï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  body {
    margin: 0;
    background: #020617;
    color: #e5e7eb;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
  }
  #chat {
    padding: 16px;
    height: calc(100vh - 120px);
    overflow-y: auto;
    font-size: 18px;
  }
  .you { color: #38bdf8; margin: 8px 0; }
  .air { color: #e5e7eb; margin: 8px 0; }
  .noel { color: #a5b4fc; margin: 8px 0; }

  #inputArea {
    display: flex;
    gap: 8px;
    padding: 12px;
    background: #020617;
  }
  input {
    flex: 1;
    padding: 12px;
    border-radius: 20px;
    border: none;
    font-size: 16px;
  }
  button {
    padding: 10px 16px;
    border-radius: 20px;
    border: none;
    font-size: 16px;
    background: #38bdf8;
    color: #020617;
  }
</style>
</head>
<body>

<div id="chat"></div>

<div id="inputArea">
  <input id="text" placeholder="è©±ã—ã‹ã‘ã¦ï¼ˆå£°ã§ã‚‚OKï¼‰" />
  <button onclick="send()">é€ã‚‹</button>
  <button onclick="startVoice()">ğŸ¤</button>
</div>

<script>
// ===== æ—¥æœ¬æ™‚é–“ =====
function getJST() {
  const now = new Date();
  return new Date(now.getTime() + (9 * 60 + now.getTimezoneOffset()) * 60000);
}

const days = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];

const timetable = {
  "æœˆ": ["æ•°å­¦","è‹±ã‚³ãƒŸãƒ¥","ä½“è‚²","å›½èª"],
  "ç«": ["è‹±ã‚³ãƒŸãƒ¥","æ•°å­¦","ç†ç§‘","å…¬å…±"],
  "æ°´": ["å›½èª","ç†ç§‘","ä½“è‚²","LHR"],
  "æœ¨": ["éŸ³æ¥½","æƒ…å ±","å®¶åº­","æ•°å­¦"],
  "é‡‘": ["å…¬å…±","æ•°å­¦","è‹±ã‚³ãƒŸãƒ¥","å›½èª"]
};

// ===== è¡¨ç¤º =====
const chat = document.getElementById("chat");
function say(who, text) {
  const div = document.createElement("div");
  div.className = who;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// ===== ä¼šè©±å‡¦ç† =====
function processMessage(msg) {
  const now = getJST();
  const day = days[now.getDay()];
  const hour = now.getHours();

  let air = "â€¦â€¦ã†ã‚“ã€èã„ã¦ã‚‹ã€‚";
  let noel = "";

  if (msg.includes("ä»Šæ—¥")) {
    air = `â€¦â€¦ä»Šæ—¥ã¯${day}æ›œæ—¥ã€‚`;
    if (timetable[day]) {
      noel = `æˆæ¥­ã¯ ${timetable[day].join("ã€")} ã ã‚ˆã€‚`;
    }
  }

  if (msg.includes("ä»Š") && msg.includes("ä½•æ™‚")) {
    air = `â€¦â€¦ä»Šã¯ ${hour}æ™‚ã€‚`;
  }

  if (msg.includes("ç–²ã‚ŒãŸ")) {
    air = "â€¦â€¦ç„¡ç†ã—ãªãã¦ã„ã„ã€‚";
    noel = "ã¡ã‚ƒã‚“ã¨ä¼‘ã‚‚ã†ã€‚æ·±å‘¼å¸ã—ã‚ˆã€‚";
  }

  if (msg.includes("ã‚ã‚ŠãŒã¨ã†")) {
    air = "â€¦â€¦ã©ã†ã„ãŸã—ã¾ã—ã¦ã€‚";
    noel = "ã“ã¡ã‚‰ã“ãã€è©±ã—ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã€‚";
  }

  if (Math.random() < 0.25 && !noel) {
    noel = ["ä»Šæ—¥ã¯ã©ã†ï¼Ÿ","ã¡ã‚ƒã‚“ã¨æ°´é£²ã‚“ã§ã‚‹ï¼Ÿ","ç„¡ç†ã—ã¦ãªã„ï¼Ÿ"][Math.floor(Math.random()*3)];
  }

  say("air", "Airï¼š " + air);
  if (noel) say("noel", "Noelï¼š " + noel);
}

// ===== é€ä¿¡ =====
function send() {
  const input = document.getElementById("text");
  const msg = input.value.trim();
  if (!msg) return;
  input.value = "";
  say("you", "å›ï¼š " + msg);
  processMessage(msg);
}

// ===== éŸ³å£°å…¥åŠ› =====
function startVoice() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å…¥åŠ›ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“");
    return;
  }

  const recognition = new SpeechRecognition();
  recognition.lang = "ja-JP";
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.start();

  recognition.onresult = (e) => {
    const text = e.results[0][0].transcript;
    document.getElementById("text").value = text;
    send();
  };
}

// åˆæœŸ
say("air","Airï¼š â€¦â€¦å£°ã§ã‚‚ã€æ–‡å­—ã§ã‚‚ã€ã¡ã‚ƒã‚“ã¨å±Šãã€‚");
say("noel","Noelï¼š ãƒã‚¤ã‚¯æŠ¼ã—ã¦è©±ã—ã¦ã¿ã¦ã­ã€‚");
</script>
</body>
</html>
