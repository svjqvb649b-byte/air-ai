<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Air</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  background: #0b1220;
  color: white;
  font-family: system-ui;
}
.container {
  padding: 20px;
  max-width: 600px;
  margin: auto;
}
.title {
  text-align: center;
  font-size: 40px;
  margin-top: 30px;
}
.status {
  text-align: center;
  opacity: 0.7;
  margin-bottom: 20px;
}
.chat {
  background: rgba(0,0,0,0.3);
  border-radius: 16px;
  padding: 20px;
  min-height: 320px;
  overflow-y: auto;
}
.you {
  color: #4fc3f7;
  margin-bottom: 6px;
}
.air {
  margin-bottom: 14px;
}
.input-area {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}
input {
  flex: 1;
  padding: 12px;
  border-radius: 20px;
  border: none;
}
button {
  padding: 12px 18px;
  border-radius: 20px;
  border: none;
  background: #4fc3f7;
  font-weight: bold;
}
</style>
</head>
<body>

<div class="container">
  <div class="title">Air</div>
  <div class="status">待機中</div>
  <div class="chat" id="chat"></div>

  <div class="input-area">
    <input id="input" placeholder="ここに話しかけて">
    <button onclick="send()">送る</button>
  </div>
</div>

<script>
// ===== 時間割 =====
const timetable = {
  1:{1:"数学Ⅰ",2:"英語コミュⅠ",3:"体育",4:"言語文化",5:"家庭基礎",6:"音楽Ⅰ"},
  2:{1:"英語コミュⅠ",2:"現代の国語",3:"数学Ⅰ",4:"保健",5:"公共",6:"総合"},
  3:{1:"英語コミュⅠ",2:"科学と人間生活",3:"言語文化",4:"歴史総合",5:"体育",6:"LHR"},
  4:{1:"音楽Ⅰ",2:"科学と人間生活",3:"情報Ⅰ",4:"家庭基礎",5:"体育",6:"数学Ⅰ"},
  5:{1:"公共",2:"数学Ⅰ",3:"英語コミュⅠ",4:"歴史総合",5:"現代の国語",6:"情報Ⅰ"}
};

// ===== 授業時間 =====
const periods = [
  {name:"1限",start:"08:50"},
  {name:"2限",start:"09:50"},
  {name:"3限",start:"10:50"},
  {name:"4限",start:"11:50"},
  {name:"昼休み",start:"12:40"},
  {name:"5限",start:"13:25"},
  {name:"6限",start:"14:25"}
];

// ===== 雑談 =====
const aizuchi = ["……そうなんだ。","なるほど。","……ふむ。","それで？"];
const casual = ["……うん。聞いてる。","無理に話さなくてもいい。","続けて。"];

// ===== メモリー =====
const memory = {
  tired:false,
  name:null
};

// ===== 共通 =====
function reply(t){
  chat.innerHTML += `<div class="air">Air：${t}</div>`;
  chat.scrollTop = chat.scrollHeight;
}
function rand(a){ return a[Math.floor(Math.random()*a.length)]; }
function toMin(t){ const [h,m]=t.split(":").map(Number); return h*60+m; }
function nowMin(){ const d=new Date(); return d.getHours()*60+d.getMinutes(); }
function wd(d=new Date()){ const n=d.getDay(); return n===0?7:n; }

// ===== 起動時 =====
window.onload = ()=>{
  const h = new Date().getHours();
  if(h < 10) reply("……おはよう。今日は無理しないで。");
  else reply("……来たんだ。");
  startIdleWatch();
};

// ===== 沈黙検知 =====
let idleTimer;
function startIdleWatch(){
  clearTimeout(idleTimer);
  idleTimer = setTimeout(()=>{
    reply("……静かだね。");
  }, 90000); // 90秒
}

// ===== メイン =====
function send(){
  startIdleWatch();
  const input=document.getElementById("input");
  const text=input.value.trim();
  if(!text) return;
  chat.innerHTML += `<div class="you">君：${text}</div>`;
  input.value="";

  const todayKey = wd();
  const tomorrowKey = wd(new Date(Date.now()+86400000));

  if(text.includes("ありがとう")){
    reply("……どういたしまして。");
    if(memory.tired) setTimeout(()=>reply("さっき疲れてたよね。"),700);
  }
  else if(text.includes("自己紹介")){
    reply("私はAir。君の学校生活を、静かに支える存在。");
  }
  else if(text.includes("疲れ")){
    memory.tired = true;
    reply("……少し休もう。");
  }
  else if(text.includes("明日")){
    const t = timetable[tomorrowKey];
    if(!t) reply("明日は休み。");
    else{
      let m="明日は、";
      for(let i=1;i<=6;i++) m+=`${i}限は${t[i]}、`;
      reply(m.slice(0,-1)+"。");
      setTimeout(()=>reply("放課後は部活。16時から18時まで。"),700);
    }
  }
  else if(text.includes("次")){
    const now=nowMin();
    const p=periods.find(p=>now<toMin(p.start));
    if(!p) reply("今日はもう終わり。");
    else if(p.name==="昼休み") reply("次は昼休み。");
    else reply(`次は${p.name}。${timetable[todayKey]?.[Number(p.name[0])] ?? ""}`);
  }
  else if(
    text.includes("暇")||text.includes("眠")||text.includes("部活")||text.includes("学校")
  ){
    reply(rand(aizuchi));
    setTimeout(()=>reply(rand(casual)),700);
  }
  else{
    reply(rand(casual));
    setTimeout(()=>reply("今日は、どんな一日だった？"),900);
  }
}
</script>
</body>
</html>
