<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Air & Noel</title>
<style>
body {
  background:#0b1020;
  color:#fff;
  font-family:sans-serif;
}
#chat {
  height:80vh;
  overflow-y:auto;
}
.air { color:#ccc; }
.noel { color:#9ad; }
.user { color:#4af; }
button { margin:4px; }
</style>
</head>
<body>

<button id="notifyBtn">ğŸ”” é€šçŸ¥ï¼šOFF</button>
<div id="chat"></div>

<input id="input" placeholder="ã“ã“ã«è©±ã—ã‹ã‘ã¦" />
<button onclick="send()">é€ã‚‹</button>

<script>
// =====================
// çŠ¶æ…‹
// =====================
let notificationEnabled = false;
let twoPersonMode = false;
let lastUserTime = Date.now();

let memory = [];
const MEMORY_LIMIT = 5;

// =====================
// æ™‚é–“å‰²
// =====================
const timetable = {
  Monday: ["æ•°å­¦â… ","è‹±èªã‚³ãƒŸãƒ¥â… ","ä½“è‚²","è¨€èªæ–‡åŒ–","å®¶åº­åŸºç¤","éŸ³æ¥½â… "],
  Tuesday:["è‹±èªã‚³ãƒŸãƒ¥â… ","ç¾ä»£ã®å›½èª","æ•°å­¦â… ","ä¿å¥","å…¬å…±","ç·åˆ"],
  Wednesday:["è‹±èªã‚³ãƒŸãƒ¥â… ","ç§‘å­¦ã¨äººé–“ç”Ÿæ´»","è¨€èªæ–‡åŒ–","æ­´å²ç·åˆ","ä½“è‚²","LHR"],
  Thursday:["éŸ³æ¥½â… ","ç§‘å­¦ã¨äººé–“ç”Ÿæ´»","æƒ…å ±â… ","å®¶åº­åŸºç¤","ä½“è‚²","æ•°å­¦â… "],
  Friday:["å…¬å…±","æ•°å­¦â… ","è‹±èªã‚³ãƒŸãƒ¥â… ","æ­´å²ç·åˆ","ç¾ä»£ã®å›½èª","æƒ…å ±â… "]
};

// =====================
// ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
// =====================
function addMessage(who, text) {
  const div = document.createElement("div");
  div.className = who;
  div.textContent = `${who === "user" ? "å›" : who} : ${text}`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function remember(text) {
  memory.push(text);
  if (memory.length > MEMORY_LIMIT) memory.shift();
}

function todayKey(offset=0) {
  const d = new Date();
  d.setDate(d.getDate()+offset);
  return ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][d.getDay()];
}

function currentPeriod() {
  const h = new Date().getHours();
  if (h < 9) return 0;
  if (h <10) return 1;
  if (h <11) return 2;
  if (h <12) return 3;
  if (h <14) return 4;
  if (h <15) return 5;
  return null;
}

// =====================
// å¿œç­”ãƒ­ã‚¸ãƒƒã‚¯
// =====================
function respond(text) {
  const t = text.toLowerCase();

  // æŒ¨æ‹¶
  if (/ãŠã¯ã‚ˆã†|ã“ã‚“ã«ã¡ã¯|ã“ã‚“ã°ã‚“ã¯/.test(text)) {
    addMessage("air","â€¦â€¦èã„ã¦ã‚‹ã€‚");
    addMessage("noel","ã¡ã‚ƒã‚“ã¨ã„ã‚‹ã‚ˆã€‚");
    return;
  }

  // æ„Ÿè¬
  if (/ã‚ã‚ŠãŒã¨ã†|åŠ©ã‹ã£ãŸ/.test(text)) {
    addMessage("air","â€¦â€¦å•é¡Œãªã„ã€‚");
    addMessage("noel","ãã†è¨€ã£ã¦ã‚‚ã‚‰ãˆã¦å¬‰ã—ã„ã€‚");
    return;
  }

  // 2äººä¼šè©±ãƒ¢ãƒ¼ãƒ‰
  if (/2äººã§|äºŒäººã§/.test(text)) {
    twoPersonMode = true;
    addMessage("air","â€¦â€¦å°‘ã—è©±ãã†ã€‚");
    addMessage("noel","ã†ã‚“ã€‚");
    return;
  }

  // äºˆå®šç³»
  if (/æ˜æ—¥/.test(text)) showSchedule(1);
  else if (/ä»Šæ—¥/.test(text)) showSchedule(0);
  else if (/æœˆ|ç«|æ°´|æœ¨|é‡‘/.test(text)) {
    const map = {æœˆ:"Monday",ç«:"Tuesday",æ°´:"Wednesday",æœ¨:"Thursday",é‡‘:"Friday"};
    Object.keys(map).forEach(k=>{
      if (text.includes(k)) showScheduleByKey(map[k]);
    });
  }
  else {
    addMessage("air","â€¦â€¦èã„ã¦ã‚‹ã€‚");
  }
}

function showSchedule(offset) {
  const key = todayKey(offset);
  showScheduleByKey(key);
}

function showScheduleByKey(key) {
  if (!timetable[key]) {
    addMessage("noel","ãã®æ—¥ã¯æˆæ¥­ãªã„ã‚ˆã€‚");
    return;
  }
  const p = currentPeriod();
  if (p === null) {
    addMessage("noel",`${key}ã®æˆæ¥­ï¼š${timetable[key].join("ã€")}`);
  } else {
    addMessage("air",`â€¦â€¦æ¬¡ã¯ ${timetable[key][p]}`);
  }
}

// =====================
// é€ä¿¡
// =====================
function send() {
  const v = input.value.trim();
  if (!v) return;
  input.value = "";
  lastUserTime = Date.now();
  addMessage("user",v);
  remember(v);
  respond(v);
}

// =====================
// æ”¾ç½®2äººä¼šè©±
// =====================
setInterval(()=>{
  if (!twoPersonMode) return;
  if (Date.now()-lastUserTime < 20000) return;

  // è£ç›¸è«‡ï¼ˆè¡¨ç¤ºã—ãªã„ï¼‰
  const topic = memory[memory.length-1] || "æ™‚é–“";

  // è¡¨ç¤ºä¼šè©±
  addMessage("air","â€¦â€¦æ™‚é–“ã¯é€²ã‚“ã§ã‚‹ã€‚");
  addMessage("noel","ãã®ã¾ã¾ã§å¤§ä¸ˆå¤«ã€‚");

  lastUserTime = Date.now();
},25000);

// =====================
// é€šçŸ¥ãƒœã‚¿ãƒ³
// =====================
notifyBtn.onclick = ()=>{
  notificationEnabled = !notificationEnabled;
  notifyBtn.textContent = notificationEnabled ? "ğŸ”” é€šçŸ¥ï¼šON" : "ğŸ”• é€šçŸ¥ï¼šOFF";
};
</script>
</body>
</html>
