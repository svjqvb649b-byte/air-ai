<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air</title>
<style>
body{
  margin:0;
  background:linear-gradient(#0b1220,#020617);
  color:#e5e7eb;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
}
#app{height:100vh;display:flex;flex-direction:column;}
header{text-align:center;padding:14px;}
#chat{flex:1;padding:16px;overflow-y:auto;}
.user{color:#38bdf8;margin-bottom:6px;}
.air{color:#e5e7eb;margin-bottom:4px;}
.noel{color:#c7d2fe;margin-bottom:10px;font-size:.95em;}
footer{display:flex;padding:10px;gap:8px;}
input{flex:1;padding:10px;border-radius:20px;border:none;}
button{padding:10px 16px;border-radius:20px;border:none;background:#38bdf8;color:#020617;}
</style>
</head>

<body>
<div id="app">
<header>
  <h1>Air</h1>
  <p>君と、ノエルと</p>
</header>

<div id="chat"></div>

<footer>
  <input id="input" placeholder="話しかけて">
  <button onclick="send()">送る</button>
</footer>
</div>

<script>
const chat=document.getElementById("chat");
const input=document.getElementById("input");

/* ===== 時間割 ===== */
const schedule={
  月曜日:{1:"数学Ⅰ",2:"英語コミュⅠ",3:"体育",4:"言語文化",5:"家庭基礎",6:"音楽Ⅰ"},
  火曜日:{1:"英語コミュⅠ",2:"現代の国語",3:"数学Ⅰ",4:"保健",5:"公共",6:"総合"},
  水曜日:{1:"英語コミュⅠ",2:"科学と人間生活",3:"言語文化",4:"歴史総合",5:"体育",6:"LHR"},
  木曜日:{1:"音楽Ⅰ",2:"科学と人間生活",3:"情報Ⅰ",4:"家庭基礎",5:"体育",6:"数学Ⅰ"},
  金曜日:{1:"公共",2:"数学Ⅰ",3:"英語コミュⅠ",4:"歴史総合",5:"現代の国語",6:"情報Ⅰ"}
};

/* ===== 授業時間 ===== */
const periodTime=[
  {s:"08:50",e:"09:40"},
  {s:"09:50",e:"10:40"},
  {s:"10:50",e:"11:40"},
  {s:"11:50",e:"12:40"},
  {s:"13:25",e:"14:15"},
  {s:"14:25",e:"15:15"}
];

/* ===== ユーティリティ ===== */
function getDayName(offset=0){
  const d=new Date(); d.setDate(d.getDate()+offset);
  return ["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"][d.getDay()];
}
function getNowMinutes(){
  const n=new Date(); return n.getHours()*60+n.getMinutes();
}
function getCurrentPeriod(){
  const now=getNowMinutes();
  for(let i=0;i<periodTime.length;i++){
    const [sh,sm]=periodTime[i].s.split(":").map(Number);
    const [eh,em]=periodTime[i].e.split(":").map(Number);
    if(now>=sh*60+sm && now<=eh*60+em) return i+1;
  }
  return null;
}

/* ===== ノエル短期記憶 ===== */
const noelMemory=[];
function noelThink(text){
  let type="通常";
  if(/疲れ|つかれ/.test(text)) type="感情";
  else if(/今|次|今日|明日|曜|限/.test(text)) type="予定";
  else if(/暇|雑談/.test(text)) type="雑談";
  noelMemory.push(type);
  if(noelMemory.length>3) noelMemory.shift();
  return type;
}

/* ===== 雑談 ===== */
function smallTalk(){
  const l=[
    "……静かな時間だね。",
    "……ちゃんと聞いてる。",
    "……君のペースでいい。",
    "……今の空気、悪くない。",
    "……無理しなくていい。"
  ];
  return l[Math.floor(Math.random()*l.length)];
}

/* ===== ノエル発言 ===== */
function noelLine(){
  const l=[
    "状況、ちゃんと見えてるよ。",
    "流れは自然。",
    "今は焦らなくていい。",
    "予定の話だね。",
    "休憩も大事。"
  ];
  return l[Math.floor(Math.random()*l.length)];
}

/* ===== エア返答 ===== */
function airReply(text){
  const mode=noelThink(text);
  const today=getDayName();
  const tomorrow=getDayName(1);
  const p=getCurrentPeriod();
  let r="……うん。聞いてる。";

  if(mode==="感情"){
    r="……無理しなくていい。今日は、よくやってる。";
  }

  else if(mode==="雑談"){
    r=smallTalk();
  }

  else if(mode==="予定"){
    if(/今/.test(text)){
      r=p ? `今は${p}限。${schedule[today]?.[p] || "授業なし"}。`
          : "……今は授業時間じゃない。";
    }
    else if(/次/.test(text)){
      r=p && p<6 ? `次は${p+1}限。${schedule[today][p+1]}。`
                : "……次はもう授業ない。";
    }
    else if(/明日/.test(text)){
      r=`明日は${tomorrow}。1限は${schedule[tomorrow][1]}。`;
    }
    else{
      for(const d in schedule){
        if(text.includes(d)){
          r=`${d}は、1限${schedule[d][1]}、2限${schedule[d][2]}、3限${schedule[d][3]}…。`;
        }
      }
    }
  }
  return r;
}

/* ===== 送信 ===== */
function send(){
  const text=input.value.trim();
  if(!text) return;

  chat.innerHTML+=`<div class="user">君 : ${text}</div>`;

  const air=airReply(text);
  chat.innerHTML+=`<div class="air">Air : ${air}</div>`;

  // ノエル→エア→ノエル会話（30%）
  if(Math.random()<0.3){
    chat.innerHTML+=`<div class="noel">Noel : ${noelLine()}</div>`;
    chat.innerHTML+=`<div class="air">Air : ……うん、ありがとう。</div>`;
  }

  chat.scrollTop=chat.scrollHeight;
  input.value="";
}
</script>
</body>
</html>
