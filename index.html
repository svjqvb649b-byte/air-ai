<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Air & Noel</title>
<style>
  body {
    margin: 0;
    background: linear-gradient(180deg, #020617, #020617);
    color: #e5e7eb;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
  }
  #chat {
    padding: 20px;
    height: calc(100vh - 70px);
    overflow-y: auto;
  }
  .you { color: #38bdf8; margin: 6px 0; }
  .air { color: #e5e7eb; margin: 6px 0; }
  .noel { color: #a5b4fc; margin: 6px 0; }
  #inputArea {
    display: flex;
    padding: 10px;
    background: #020617;
  }
  input {
    flex: 1;
    padding: 10px;
    border-radius: 20px;
    border: none;
    outline: none;
  }
  button {
    margin-left: 10px;
    padding: 0 18px;
    border-radius: 20px;
    border: none;
    background: #38bdf8;
    color: #020617;
  }
</style>
</head>
<body>

<div id="chat"></div>

<div id="inputArea">
  <input id="text" placeholder="ここに話しかけて" />
  <button onclick="send()">送る</button>
</div>

<script>
// ======================
// 日本時間取得（ズレ修正）
// ======================
function getJSTDate() {
  const now = new Date();
  const jstOffset = 9 * 60;
  const localOffset = now.getTimezoneOffset();
  return new Date(now.getTime() + (jstOffset + localOffset) * 60000);
}

// ======================
// 時間割データ
// ======================
const timetable = {
  "月": ["数学Ⅰ","英語コミュⅠ","体育","言語文化","家庭基礎","音楽Ⅰ"],
  "火": ["英語コミュⅠ","現代の国語","数学Ⅰ","保健","公共","総合"],
  "水": ["英語コミュⅠ","科学と人間生活","言語文化","歴史総合","体育","LHR"],
  "木": ["音楽Ⅰ","科学と人間生活","情報Ⅰ","家庭基礎","体育","数学Ⅰ"],
  "金": ["公共","数学Ⅰ","英語コミュⅠ","歴史総合","現代の国語","情報Ⅰ"]
};

const days = ["日","月","火","水","木","金","土"];

// ======================
// 表示
// ======================
const chat = document.getElementById("chat");
function say(who, text) {
  const div = document.createElement("div");
  div.className = who;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// ======================
// メイン処理
// ======================
function send() {
  const input = document.getElementById("text");
  const msg = input.value.trim();
  if (!msg) return;
  input.value = "";

  say("you", "君： " + msg);

  const now = getJSTDate();
  const day = days[now.getDay()];
  const hour = now.getHours();

  let airReply = "……うん。聞いてる。";
  let noelReply = "";

  // ===== 呼びかけ判定 =====
  const callAir = msg.includes("エア");
  const callNoel = msg.includes("ノエル");

  // ===== 今日・予定 =====
  if (msg.includes("今日")) {
    airReply = `……今日は${day}曜日。`;
    if (timetable[day]) {
      airReply += ` 授業は${timetable[day].length}限まである。`;
    }
  }

  // ===== 今何限 =====
  if (msg.includes("今") && msg.includes("何限")) {
    const period = hour < 9 ? 0 :
                   hour < 10 ? 1 :
                   hour < 11 ? 2 :
                   hour < 12 ? 3 :
                   hour < 14 ? 4 :
                   hour < 15 ? 5 :
                   hour < 16 ? 6 : 0;

    if (period === 0) {
      airReply = "……今は授業時間じゃない。";
    } else {
      airReply = `……今は${period}限。${timetable[day]?.[period-1] || ""}`;
    }
  }

  // ===== 明日の時間割 =====
  if (msg.includes("明日")) {
    const tomorrow = days[(now.getDay()+1)%7];
    if (timetable[tomorrow]) {
      airReply = `……明日は${tomorrow}曜日。`;
      noelReply = `時間割は ${timetable[tomorrow].join("、")} だよ。`;
    }
  }

  // ===== 雑談 =====
  if (msg.includes("疲れた")) {
    airReply = "……無理しなくていい。";
    noelReply = "ちゃんと休めてる？少し深呼吸しよ。";
  }

  // ===== 感情 =====
  if (msg.includes("ありがとう")) {
    airReply = "……どういたしまして。";
    noelReply = "そう言ってもらえるの、嬉しいな。";
  }

  // ===== Noel割り込み（ランダム） =====
  if (!noelReply && Math.random() < 0.3) {
    noelReply = ["今日は寒いね。","ちゃんと朝ごはん食べた？","無理しすぎないでね。"][Math.floor(Math.random()*3)];
  }

  // ===== 出力 =====
  if (callAir || !callNoel) say("air", "Air： " + airReply);
  if (callNoel || noelReply) say("noel", "Noel： " + (noelReply || "呼んでくれてありがとう。"));
}

// 初期メッセージ
say("air","Air： ……うん。ここにいる。");
say("noel","Noel： おはよう。今日も一緒に話そう。");
</script>
</body>
</html>
