<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air</title>
<style>
body {
  margin: 0;
  background: linear-gradient(#0b1220, #020617);
  color: #e5e7eb;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}
#app {
  height: 100vh;
  display: flex;
  flex-direction: column;
}
header {
  text-align: center;
  padding: 14px;
}
#chat {
  flex: 1;
  padding: 16px;
  overflow-y: auto;
}
.user { color: #38bdf8; margin-bottom: 6px; }
.air { color: #e5e7eb; margin-bottom: 6px; white-space: pre-line; }
.noel { color: #c7d2fe; margin-bottom: 14px; font-size: 0.95em; }
footer {
  display: flex;
  padding: 10px;
  gap: 8px;
}
input {
  flex: 1;
  padding: 10px;
  border-radius: 20px;
  border: none;
}
button {
  padding: 10px 16px;
  border-radius: 20px;
  border: none;
  background: #38bdf8;
  color: #020617;
}
</style>
</head>

<body>
<div id="app">
<header>
  <h1>Air</h1>
  <p>待機中</p>
</header>

<div id="chat"></div>

<footer>
  <input id="input" placeholder="ここに話しかけて" />
  <button onclick="send()">送る</button>
</footer>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

/* ===== ノエル短期記憶 ===== */
const noelMemory = [];

/* ===== 時間割 ===== */
const schedule = {
  月曜日:{1:"数学Ⅰ",2:"英語コミュⅠ",3:"体育",4:"言語文化",5:"家庭基礎",6:"音楽Ⅰ"},
  火曜日:{1:"英語コミュⅠ",2:"現代の国語",3:"数学Ⅰ",4:"保健",5:"公共",6:"総合"},
  水曜日:{1:"英語コミュⅠ",2:"科学と人間生活",3:"言語文化",4:"歴史総合",5:"体育",6:"LHR"},
  木曜日:{1:"音楽Ⅰ",2:"科学と人間生活",3:"情報Ⅰ",4:"家庭基礎",5:"体育",6:"数学Ⅰ"},
  金曜日:{1:"公共",2:"数学Ⅰ",3:"英語コミュⅠ",4:"歴史総合",5:"現代の国語",6:"情報Ⅰ"}
};

/* ===== 授業時間 ===== */
const periodsTime = [
  { start:"08:50", end:"09:40" },
  { start:"09:50", end:"10:40" },
  { start:"10:50", end:"11:40" },
  { start:"11:50", end:"12:40" },
  { start:"13:25", end:"14:15" },
  { start:"14:25", end:"15:15" }
];

/* ===== 雑談 ===== */
function getSmallTalk() {
  const talks = [
    "……静かな時間も、悪くない。",
    "……君のペースでいい。",
    "……今日は、少し落ち着いてる。",
    "……こうして話してるだけで十分。",
    "……無理に元気出さなくていい。"
  ];
  return talks[Math.floor(Math.random()*talks.length)];
}

/* ===== 曜日・時間 ===== */
function getDayName(offset=0){
  const days=["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"];
  const d=new Date(); d.setDate(d.getDate()+offset);
  return days[d.getDay()];
}
function getCurrentPeriod(){
  const n=new Date(), m=n.getHours()*60+n.getMinutes();
  for(let i=0;i<periodsTime.length;i++){
    const [sh,sm]=periodsTime[i].start.split(":").map(Number);
    const [eh,em]=periodsTime[i].end.split(":").map(Number);
    if(m>=sh*60+sm && m<=eh*60+em) return i+1;
  }
  return null;
}

/* ===== ノエル思考 ===== */
function noelThink(text){
  let type="通常";
  if(/疲れ|つかれ/.test(text)) type="感情";
  else if(/今|次|今日|明日/.test(text)) type="予定";
  else if(/雑談|暇|なんとなく/.test(text)) type="雑談";

  noelMemory.push({text,type});
  if(noelMemory.length>3) noelMemory.shift();
  return type;
}

/* ===== ノエル一言 ===== */
function noelSpeak(){
  const lines = [
    "……ちゃんと話せてるよ。",
    "無理しなくていい。",
    "今の空気、嫌いじゃない。",
    "少し落ち着いたね。",
    "ここにいるよ。",
    "大丈夫、そのままで。",
    "今日はここまででもいい。"
  ];
  return lines[Math.floor(Math.random()*lines.length)];
}

/* ===== エア返答 ===== */
function airReply(text){
  const today=getDayName();
  const tomorrow=getDayName(1);
  const period=getCurrentPeriod();

  const mode=noelThink(text);
  let reply="……うん。聞いてる。";

  if(mode==="感情"){
    reply="……無理しなくていい。今日は、よくやってる。";
  }
  else if(mode==="予定"){
    if(/今/.test(text)){
      reply=period?`今は${period}限。${schedule[today][period]}。`:"……今は授業の時間じゃない。";
    }
    else if(/次/.test(text)){
      const next=period?period+1:null;
      reply=next?`次は${next}限。${schedule[today][next]}。`:"……次はまだ先。";
    }
    else if(/明日/.test(text)){
      reply=`明日は${tomorrow}。1限は${schedule[tomorrow][1]}。`;
    }
  }
  else if(mode==="雑談"){
    reply=getSmallTalk();
  }

  return reply;
}

/* ===== 送信 ===== */
function send(){
  const text=input.value.trim();
  if(!text) return;

  chat.innerHTML+=`<div class="user">君 : ${text}</div>`;

  const airText = airReply(text);
  chat.innerHTML+=`<div class="air">Air : ${airText}</div>`;

  // ノエルがたまに出てくる（15%）
  if(Math.random()<0.15){
    chat.innerHTML+=`<div class="noel">Noel : ${noelSpeak()}</div>`;
  }

  chat.scrollTop=chat.scrollHeight;
  input.value="";
}
</script>
</body>
</html>
