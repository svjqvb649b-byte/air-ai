<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air</title>
<style>
body {
  margin: 0;
  background: linear-gradient(#0b1220, #020617);
  color: #e5e7eb;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}
#app {
  height: 100vh;
  display: flex;
  flex-direction: column;
}
header {
  text-align: center;
  padding: 14px;
}
#chat {
  flex: 1;
  padding: 16px;
  overflow-y: auto;
}
.user { color: #38bdf8; margin-bottom: 6px; }
.air { color: #e5e7eb; margin-bottom: 14px; white-space: pre-line; }
footer {
  display: flex;
  padding: 10px;
  gap: 8px;
}
input {
  flex: 1;
  padding: 10px;
  border-radius: 20px;
  border: none;
}
button {
  padding: 10px 16px;
  border-radius: 20px;
  border: none;
  background: #38bdf8;
  color: #020617;
}
</style>
</head>

<body>
<div id="app">
<header>
  <h1>Air</h1>
  <p>待機中</p>
</header>

<div id="chat"></div>

<footer>
  <input id="input" placeholder="ここに話しかけて" />
  <button onclick="send()">送る</button>
</footer>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

/* ====== 時間割 ====== */
const schedule = {
  月曜日: {1:"数学Ⅰ",2:"英語コミュⅠ",3:"体育",4:"言語文化",5:"家庭基礎",6:"音楽Ⅰ"},
  火曜日: {1:"英語コミュⅠ",2:"現代の国語",3:"数学Ⅰ",4:"保健",5:"公共",6:"総合"},
  水曜日: {1:"英語コミュⅠ",2:"科学と人間生活",3:"言語文化",4:"歴史総合",5:"体育",6:"LHR"},
  木曜日: {1:"音楽Ⅰ",2:"科学と人間生活",3:"情報Ⅰ",4:"家庭基礎",5:"体育",6:"数学Ⅰ"},
  金曜日: {1:"公共",2:"数学Ⅰ",3:"英語コミュⅠ",4:"歴史総合",5:"現代の国語",6:"情報Ⅰ"}
};

/* ====== 授業時間 ====== */
const periodsTime = [
  { start:"08:50", end:"09:40" },
  { start:"09:50", end:"10:40" },
  { start:"10:50", end:"11:40" },
  { start:"11:50", end:"12:40" },
  { start:"13:25", end:"14:15" },
  { start:"14:25", end:"15:15" }
];

/* ====== エアからの質問 ====== */
const airQuestions = [
  "今日は、少し疲れてる？",
  "学校、どうだった？",
  "今は、静かに過ごしたい？",
  "このあと、何か楽しみある？",
  "無理してない？"
];

function maybeAskBack() {
  if (Math.random() < 0.3) {
    return "\n\nAir : " + airQuestions[Math.floor(Math.random()*airQuestions.length)];
  }
  return "";
}

/* ====== 今が何限か ====== */
function getCurrentPeriod() {
  const now = new Date();
  const h = now.getHours();
  const m = now.getMinutes();
  const nowMin = h*60 + m;

  for (let i=0;i<periodsTime.length;i++) {
    const [sh,sm] = periodsTime[i].start.split(":").map(Number);
    const [eh,em] = periodsTime[i].end.split(":").map(Number);
    if (nowMin >= sh*60+sm && nowMin <= eh*60+em) {
      return i+1;
    }
  }
  return null;
}

/* ====== 曜日取得 ====== */
function getDayName(offset=0) {
  const days = ["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"];
  const d = new Date();
  d.setDate(d.getDate()+offset);
  return days[d.getDay()];
}

/* ====== エア返答 ====== */
function airReply(text) {
  let reply = "……うん。聞いてる。";
  const today = getDayName();
  const tomorrow = getDayName(1);
  const period = getCurrentPeriod();

  if (/疲れ/.test(text)) reply = "……無理しないで。少し休んで。";
  else if (/ありがとう/.test(text)) reply = "……どういたしまして。";
  else if (/今何限|今なに/.test(text)) {
    reply = period ? `今は${period}限。${schedule[today][period]}。` : "……今は授業の時間じゃない。";
  }
  else if (/次/.test(text)) {
    const next = period ? period+1 : null;
    reply = next && schedule[today]?.[next]
      ? `次は${next}限。${schedule[today][next]}。`
      : "……次の授業までは、少し時間がある。";
  }
  else if (/今日/.test(text)) {
    reply = schedule[today]
      ? `今日は${today}。${Object.values(schedule[today]).join("、")}。`
      : "……今日は学校はない日。";
  }
  else if (/明日/.test(text)) {
    reply = schedule[tomorrow]
      ? `明日は${tomorrow}。1限は${schedule[tomorrow][1]}。`
      : "……明日はお休み。";
  }
  else if (/雑談|話/.test(text)) reply = "……こうして話してるだけでも、悪くない。";

  reply += maybeAskBack();
  return reply;
}

/* ====== 送信 ====== */
function send() {
  const text = input.value.trim();
  if (!text) return;
  chat.innerHTML += `<div class="user">君 : ${text}</div>`;
  chat.innerHTML += `<div class="air">Air : ${airReply(text)}</div>`;
  chat.scrollTop = chat.scrollHeight;
  input.value = "";
}
</script>
</body>
</html>
