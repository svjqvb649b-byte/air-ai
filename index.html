<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Air</title>
  <style>
    body {
      margin: 0;
      background: #0b1320;
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }
    #chat {
      padding: 20px;
      padding-bottom: 90px;
      line-height: 1.6;
    }
    .user { color: #4fc3ff; margin-top: 10px; }
    .air { margin-top: 4px; }

    #inputArea {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #0b1320;
      padding: 10px;
      display: flex;
      gap: 10px;
    }
    input {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
    }
    button {
      padding: 12px 16px;
      border-radius: 10px;
      border: none;
      background: #4fc3ff;
      color: #000;
      font-size: 16px;
    }
  </style>
</head>
<body>

<div id="chat"></div>

<div id="inputArea">
  <input id="input" placeholder="ここに話しかけて" />
  <button onclick="send()">送る</button>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

// ===== 曜日別時間割 =====
const weeklyTimetable = {
  1: { // 月
    1: "英語コミュ",
    2: "数学",
    3: "国語",
    4: "理科",
    5: "社会",
    6: "体育"
  },
  2: { // 火
    1: "数学",
    2: "英語",
    3: "理科",
    4: "国語",
    5: "音楽",
    6: "体育"
  },
  3: { // 水
    1: "英語コミュ",
    2: "社会",
    3: "数学",
    4: "理科"
  },
  4: { // 木
    1: "国語",
    2: "数学",
    3: "英語",
    4: "社会",
    5: "理科",
    6: "LHR"
  },
  5: { // 金
    1: "数学",
    2: "英語",
    3: "国語",
    4: "体育",
    5: "理科",
    6: "総合"
  }
};

const clubTime = "部活は16時から18時まで。";

// ===== 表示 =====
function addMessage(text, cls) {
  const div = document.createElement("div");
  div.className = cls;
  div.textContent = text;
  chat.appendChild(div);
  window.scrollTo(0, document.body.scrollHeight);
}

// ===== 時刻 → 限 =====
function getCurrentPeriod() {
  const h = new Date().getHours();
  if (h < 9) return 1;
  if (h < 10) return 2;
  if (h < 11) return 3;
  if (h < 12) return 4;
  if (h < 14) return 5;
  return 6;
}

// ===== 雑談 =====
function smallTalk(text) {
  if (/ありがとう/.test(text)) return "……どういたしまして。";
  if (/ごめん/.test(text)) return "……気にしなくていい。";
  if (/疲れた|しんどい/.test(text)) return "……少し休もう。無理はしないで。";
  if (/聞いてる/.test(text)) return "……うん。ちゃんと聞いてる。";
  if (/おはよう/.test(text)) return "……おはよう。今日は無理しないで。";
  return null;
}

// ===== メイン =====
function reply(text) {
  const today = new Date().getDay(); // 日0 月1
  const dayTable = weeklyTimetable[today];

  // 雑談優先
  const talk = smallTalk(text);
  if (talk) return talk;

  // 今日の時間割
  if (/今日.*時間割/.test(text)) {
    if (!dayTable) return "……今日は休み。";
    return "……今日は" + Object.values(dayTable).join("、") + "。";
  }

  // ○限
  const m = text.match(/(\d)限/);
  if (m && dayTable) {
    const p = Number(m[1]);
    return dayTable[p]
      ? `${p}限は${dayTable[p]}。`
      : "……その時間はない。";
  }

  // 次の授業
  if (/次/.test(text) && dayTable) {
    const p = getCurrentPeriod();
    return dayTable[p]
      ? `次は${p}限。${dayTable[p]}。`
      : "……もう授業は終わってる。";
  }

  // 部活
  if (/部活/.test(text)) return clubTime;

  return "……うん。ここにいる。";
}

// ===== 送信 =====
function send() {
  const text = input.value.trim();
  if (!text) return;
  addMessage("君 : " + text, "user");
  input.value = "";
  setTimeout(() => addMessage("Air : " + reply(text), "air"), 400);
}

addMessage("Air : ……おはよう。", "air");
</script>

</body>
</html>
