<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air & Noel</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #020617;
  color: #e5e7eb;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;

  /* ğŸ”§ æ–‡å­—ã‚µã‚¤ã‚ºã‚’ã€Œæ™®é€šã€ã«å›ºå®š */
  font-size: 16px;
  line-height: 1.7;
}

#chat {
  padding: 16px;
  height: calc(100vh - 130px);
  overflow-y: auto;
}

.you  { color: #38bdf8; margin: 10px 0; }
.air  { color: #e5e7eb; margin: 10px 0; }
.noel { color: #a5b4fc; margin: 10px 0; }

#inputArea {
  display: flex;
  padding: 10px;
  gap: 6px;
}

input {
  flex: 1;
  padding: 12px 16px;
  border-radius: 20px;
  border: none;
  font-size: 16px;
}

button {
  padding: 0 14px;
  border-radius: 20px;
  border: none;
  background: #38bdf8;
  color: #020617;
  font-size: 14px;
}
</style>
</head>

<body>

<div id="chat"></div>

<div id="inputArea">
  <input id="text" placeholder="ã“ã“ã«è©±ã—ã‹ã‘ã¦">
  <button onclick="send()">é€ã‚‹</button>
  <button onclick="toggleStory()">é•·æ–‡</button>
  <button onclick="toggleDuo()">2äºº</button>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("text");

function say(who, text) {
  const div = document.createElement("div");
  div.className = who;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ===== æ™‚é–“å‰² ===== */
const timetable = {
  "æœˆ": ["å›½èª","æ•°å­¦","è‹±èª","ç†ç§‘","ä½“è‚²"],
  "ç«": ["æ•°å­¦","ç¤¾ä¼š","è‹±èª","éŸ³æ¥½","ç¾è¡“"],
  "æ°´": ["è‹±èª","ç†ç§‘","å›½èª","æŠ€è¡“","ç·åˆ"],
  "æœ¨": ["ç¤¾ä¼š","æ•°å­¦","è‹±èª","ä½“è‚²","ç†ç§‘"],
  "é‡‘": ["å›½èª","æ•°å­¦","ç¤¾ä¼š","è‹±èª"]
};

const days = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];

function today() {
  return days[new Date().getDay()];
}

function currentPeriod() {
  const h = new Date().getHours();
  if (h < 9) return 0;
  if (h < 10) return 1;
  if (h < 11) return 2;
  if (h < 12) return 3;
  if (h < 14) return 4;
  if (h < 15) return 5;
  return -1;
}

/* ===== é€šå¸¸ä¼šè©± ===== */
function send() {
  if (storyMode) stopStory(true);
  if (duoMode) stopDuo(true);

  const msg = input.value.trim();
  if (!msg) return;
  input.value = "";

  say("you", "å›ï¼š " + msg);

  let air = null;
  let noel = null;

  const d = today();
  const p = currentPeriod();

  /* ğŸŒ… ã‚ã„ã•ã¤åˆ¤å®šï¼ˆè¿½åŠ ï¼‰ */
  if (msg.includes("ãŠã¯ã‚ˆã†")) {
    air = "æœã®æŒ¨æ‹¶ã‚’ç¢ºèªã€‚";
    noel = "ãŠã¯ã‚ˆã†ã€‚ä»Šæ—¥ã‚‚æ¥ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã€‚";
  }
  else if (msg.includes("ã“ã‚“ã«ã¡ã¯")) {
    air = "ç¾åœ¨ã¯æ—¥ä¸­ã€‚";
    noel = "ã“ã‚“ã«ã¡ã¯ã€‚èª¿å­ã¯ã©ã†ï¼Ÿ";
  }
  else if (msg.includes("ã“ã‚“ã°ã‚“ã¯")) {
    air = "æ™‚åˆ»ã¯å¤œå¸¯ã€‚";
    noel = "ã“ã‚“ã°ã‚“ã¯ã€‚ä»Šæ—¥ã‚‚ãŠç–²ã‚Œã•ã¾ã€‚";
  }

  /* æ™‚é–“å‰² */
  else if (msg.includes("ä»Šæ—¥ã®æ™‚é–“å‰²")) {
    air = "ä»Šæ—¥ã¯" + d + "æ›œæ—¥ã€‚";
    noel = timetable[d]
      ? "æˆæ¥­ã¯ã€Œ" + timetable[d].join("ã€") + "ã€ã ã‚ˆã€‚"
      : "ä»Šæ—¥ã¯æˆæ¥­ã¯ãªã„ã­ã€‚";
  }
  else if (msg.includes("ä»Šä½•é™")) {
    air = "æ™‚åˆ»ã‚’åŸºæº–ã«åˆ¤å®šã€‚";
    noel = p > 0 ? "ä»Šã¯" + p + "é™ç›®ã ã‚ˆã€‚" : "ä»Šã¯æˆæ¥­æ™‚é–“å¤–ã€‚";
  }
  else if (msg.includes("æ¬¡ã®æˆæ¥­")) {
    air = "æ¬¡ã‚’ç¢ºèªã€‚";
    noel = (timetable[d] && p >= 0 && timetable[d][p])
      ? "æ¬¡ã¯ã€Œ" + timetable[d][p] + "ã€ã€‚"
      : "æ¬¡ã¯ä¼‘æ†©ã§ã„ã„ã€‚";
  }
  else if (msg.includes("æ™‚é–“å‰²")) {
    air = "æ›œæ—¥æŒ‡å®šã‚’æ¤œå‡ºã€‚";
    for (const day in timetable) {
      if (msg.includes(day)) {
        noel = day + "æ›œã¯ã€Œ" + timetable[day].join("ã€") + "ã€ã€‚";
      }
    }
  }
  else if (msg.includes("ç–²ã‚ŒãŸ")) {
    air = "ç–²åŠ´ã‚’æ¤œçŸ¥ã€‚";
    noel = "ç„¡ç†ã—ãªãã¦ã„ã„ã‚ˆã€‚ä»Šæ—¥ã¯ã“ã“ã¾ã§ã§ã‚‚ååˆ†ã€‚";
  }
  else {
    if (Math.random() < 0.5) {
      air = "å†…å®¹ã‚’å—ç†ã€‚";
    } else {
      noel = "ã†ã‚“ã€ã¡ã‚ƒã‚“ã¨èã„ã¦ã‚‹ã€‚";
    }
  }

  if (air)  say("air",  "Airï¼š " + air);
  if (noel) say("noel", "Noelï¼š " + noel);
}

/* ===== é•·æ–‡ãƒ¢ãƒ¼ãƒ‰ ===== */
let storyMode = false;
let storyTimer = null;
let storyTurn = 0;

const airStory = [
  "å­¦æ ¡ã¯æ¶ˆè€—å‰æã€‚",
  "è€ãˆãŸäº‹å®Ÿã¯æ®‹ã‚‹ã€‚",
  "ä»Šæ—¥ã¯ã“ã‚Œã§ååˆ†ã€‚"
];

const noelStory = [
  "ã¡ã‚ƒã‚“ã¨æ¥ãŸã­ã€‚",
  "ç„¡ç†ã—ãªãã¦ã„ã„ã€‚",
  "ä»Šæ—¥ã¯å®ˆã‚ŒãŸã‚ˆã€‚"
];

function toggleStory() {
  if (duoMode) stopDuo(false);
  storyMode = !storyMode;

  if (storyMode) {
    say("noel", "Noelï¼š é•·æ–‡ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ã€‚");
    input.disabled = true;
    storyTimer = setInterval(() => {
      if (storyTurn % 2 === 0)
        say("air", "Airï¼š " + airStory[(storyTurn/2)%airStory.length]);
      else
        say("noel", "Noelï¼š " + noelStory[(storyTurn/2)%noelStory.length]);
      storyTurn++;
    }, 4000);
  } else stopStory(false);
}

function stopStory(byUser) {
  clearInterval(storyTimer);
  storyMode = false;
  storyTurn = 0;
  input.disabled = false;
  if (byUser) {
    say("air", "Airï¼š ä»‹å…¥ã‚’ç¢ºèªã€‚");
    say("noel", "Noelï¼š ãŠã‹ãˆã‚Šã€‚");
  }
}

/* ===== 2äººä¼šè©± ===== */
let duoMode = false;
let duoTimer = null;
let duoTurn = 0;

const duoAir = [
  "â€¦â€¦ååˆ†ã‚„ã£ã¦ã„ã‚‹ã€‚",
  "â€¦â€¦åˆ¤æ–­ã¯å¦¥å½“ã€‚",
  "â€¦â€¦ä»Šæ—¥ã¯ã“ã‚Œã§ã„ã„ã€‚"
];

const duoNoel = [
  "ã†ã‚“ã€åˆ†ã‹ã£ã¦ã‚‹ã€‚",
  "å°‘ã—ãšã¤ã§ã„ã„ã€‚",
  "ä»Šæ—¥ã¯å®ˆã‚ŒãŸã­ã€‚"
];

function toggleDuo() {
  if (storyMode) stopStory(false);
  duoMode = !duoMode;

  if (duoMode) {
    say("air", "Airï¼š å†…éƒ¨ä¼šè©±ãƒ¢ãƒ¼ãƒ‰ã¸ã€‚");
    input.disabled = true;
    duoTimer = setInterval(() => {
      if (duoTurn % 2 === 0)
        say("air", "Airï¼š " + duoAir[Math.floor(duoTurn/2)%duoAir.length]);
      else
        say("noel", "Noelï¼š " + duoNoel[Math.floor(duoTurn/2)%duoNoel.length]);
      duoTurn++;
    }, 4500);
  } else stopDuo(false);
}

function stopDuo(byUser) {
  clearInterval(duoTimer);
  duoMode = false;
  duoTurn = 0;
  input.disabled = false;
  if (byUser) say("noel", "Noelï¼š æˆ»ã£ã¦ããŸã­ã€‚");
}

/* åˆæœŸè¡¨ç¤º */
say("air", "Airï¼š èµ·å‹•å®Œäº†ã€‚");
say("noel", "Noelï¼š ã„ã¤ã§ã‚‚è©±ã—ã‹ã‘ã¦ã€‚");
</script>

</body>
</html>
