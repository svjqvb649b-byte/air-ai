<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air</title>
<style>
body {
  margin: 0;
  background: linear-gradient(#0b1220, #020617);
  color: #e5e7eb;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}
#app {
  height: 100vh;
  display: flex;
  flex-direction: column;
}
header {
  text-align: center;
  padding: 14px;
}
#chat {
  flex: 1;
  padding: 16px;
  overflow-y: auto;
}
.user { color: #38bdf8; margin-bottom: 6px; }
.air { color: #e5e7eb; margin-bottom: 14px; white-space: pre-line; }
footer {
  display: flex;
  padding: 10px;
  gap: 8px;
}
input {
  flex: 1;
  padding: 10px;
  border-radius: 20px;
  border: none;
}
button {
  padding: 10px 16px;
  border-radius: 20px;
  border: none;
  background: #38bdf8;
  color: #020617;
}
</style>
</head>

<body>
<div id="app">
<header>
  <h1>Air</h1>
  <p>å¾…æ©Ÿä¸­</p>
</header>

<div id="chat"></div>

<footer>
  <input id="input" placeholder="ã“ã“ã«è©±ã—ã‹ã‘ã¦" />
  <button onclick="send()">é€ã‚‹</button>
</footer>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");

/* ===== ãƒã‚¨ãƒ«ã®çŸ­æœŸè¨˜æ†¶ ===== */
const noelMemory = []; // { text, type }

/* ===== æ™‚é–“å‰² ===== */
const schedule = {
  æœˆæ›œæ—¥:{1:"æ•°å­¦â… ",2:"è‹±èªã‚³ãƒŸãƒ¥â… ",3:"ä½“è‚²",4:"è¨€èªæ–‡åŒ–",5:"å®¶åº­åŸºç¤",6:"éŸ³æ¥½â… "},
  ç«æ›œæ—¥:{1:"è‹±èªã‚³ãƒŸãƒ¥â… ",2:"ç¾ä»£ã®å›½èª",3:"æ•°å­¦â… ",4:"ä¿å¥",5:"å…¬å…±",6:"ç·åˆ"},
  æ°´æ›œæ—¥:{1:"è‹±èªã‚³ãƒŸãƒ¥â… ",2:"ç§‘å­¦ã¨äººé–“ç”Ÿæ´»",3:"è¨€èªæ–‡åŒ–",4:"æ­´å²ç·åˆ",5:"ä½“è‚²",6:"LHR"},
  æœ¨æ›œæ—¥:{1:"éŸ³æ¥½â… ",2:"ç§‘å­¦ã¨äººé–“ç”Ÿæ´»",3:"æƒ…å ±â… ",4:"å®¶åº­åŸºç¤",5:"ä½“è‚²",6:"æ•°å­¦â… "},
  é‡‘æ›œæ—¥:{1:"å…¬å…±",2:"æ•°å­¦â… ",3:"è‹±èªã‚³ãƒŸãƒ¥â… ",4:"æ­´å²ç·åˆ",5:"ç¾ä»£ã®å›½èª",6:"æƒ…å ±â… "}
};

/* ===== æˆæ¥­æ™‚é–“ ===== */
const periodsTime = [
  { start:"08:50", end:"09:40" },
  { start:"09:50", end:"10:40" },
  { start:"10:50", end:"11:40" },
  { start:"11:50", end:"12:40" },
  { start:"13:25", end:"14:15" },
  { start:"14:25", end:"15:15" }
];

/* ===== é›‘è«‡ ===== */
function getSmallTalk() {
  const talks = [
    "â€¦â€¦é™ã‹ãªæ™‚é–“ã‚‚ã€å«Œã„ã˜ã‚ƒãªã„ã€‚",
    "â€¦â€¦å°‘ã—è½ã¡ç€ã„ãŸï¼Ÿ",
    "â€¦â€¦ä»Šã®æµã‚Œã€æ‚ªããªã„ã€‚",
    "â€¦â€¦è©±ã—ã¦ãã‚Œã¦ã‚‹ã€ãã‚Œã ã‘ã§ã„ã„ã€‚",
    "â€¦â€¦ç„¡ç†ã«å…ƒæ°—å‡ºã•ãªãã¦ã„ã„ã€‚"
  ];
  return talks[Math.floor(Math.random()*talks.length)];
}

/* ===== æ›œæ—¥ãƒ»æ™‚é–“ ===== */
function getDayName(offset=0){
  const days=["æ—¥æ›œæ—¥","æœˆæ›œæ—¥","ç«æ›œæ—¥","æ°´æ›œæ—¥","æœ¨æ›œæ—¥","é‡‘æ›œæ—¥","åœŸæ›œæ—¥"];
  const d=new Date(); d.setDate(d.getDate()+offset);
  return days[d.getDay()];
}
function getCurrentPeriod(){
  const n=new Date(), m=n.getHours()*60+n.getMinutes();
  for(let i=0;i<periodsTime.length;i++){
    const [sh,sm]=periodsTime[i].start.split(":").map(Number);
    const [eh,em]=periodsTime[i].end.split(":").map(Number);
    if(m>=sh*60+sm && m<=eh*60+em) return i+1;
  }
  return null;
}

/* =================================================
   ğŸ§  ãƒã‚¨ãƒ«ï¼ˆçŸ­æœŸè¨˜æ†¶ã¤ãï¼‰
   ================================================= */
function noelThink(text){
  let type="é€šå¸¸";
  if(/ç–²ã‚Œ|ã¤ã‹ã‚Œ/.test(text)) type="æ„Ÿæƒ…";
  else if(/ä»Š|æ¬¡|ä»Šæ—¥|æ˜æ—¥/.test(text)) type="äºˆå®š";
  else if(/é›‘è«‡|æš‡|ãªã‚“ã¨ãªã/.test(text)) type="é›‘è«‡";

  // è¨˜æ†¶ã«è¿½åŠ 
  noelMemory.push({ text, type });
  if(noelMemory.length>3) noelMemory.shift();

  return type;
}

/* =================================================
   ğŸ¤– ã‚¨ã‚¢
   ================================================= */
function airReply(text){
  const today=getDayName();
  const tomorrow=getDayName(1);
  const period=getCurrentPeriod();

  const mode=noelThink(text);
  const last=noelMemory[noelMemory.length-2];

  let reply="â€¦â€¦ã†ã‚“ã€‚èã„ã¦ã‚‹ã€‚";

  if(mode==="æ„Ÿæƒ…"){
    reply="â€¦â€¦ã•ã£ãã‹ã‚‰ã€å°‘ã—ç„¡ç†ã—ã¦ã‚‹æ°—ãŒã™ã‚‹ã€‚ä¼‘ã‚“ã§ã€‚";
  }
  else if(mode==="äºˆå®š"){
    if(/æ¬¡/.test(text) && last?.type==="äºˆå®š"){
      const next=period?period+1:null;
      reply=next?`æ¬¡ã¯${next}é™ã€‚${schedule[today][next]}ã€‚`:"â€¦â€¦æ¬¡ã¯ã¾ã å…ˆã€‚";
    }
    else if(/ä»Š/.test(text)){
      reply=period?`ä»Šã¯${period}é™ã€‚${schedule[today][period]}ã€‚`:"â€¦â€¦ä»Šã¯æˆæ¥­å¤–ã€‚";
    }
    else if(/æ˜æ—¥/.test(text)){
      reply=`æ˜æ—¥ã¯${tomorrow}ã€‚1é™ã¯${schedule[tomorrow][1]}ã€‚`;
    }
  }
  else if(mode==="é›‘è«‡"){
    reply=getSmallTalk();
  }

  return reply;
}

/* ===== é€ä¿¡ ===== */
function send(){
  const text=input.value.trim();
  if(!text) return;
  chat.innerHTML+=`<div class="user">å› : ${text}</div>`;
  chat.innerHTML+=`<div class="air">Air : ${airReply(text)}</div>`;
  chat.scrollTop=chat.scrollHeight;
  input.value="";
}
</script>
</body>
</html>
