<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air & Noel</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #020617;
  color: #e5e7eb;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  font-size: 16px;
  line-height: 1.7;
}

#chat {
  padding: 16px;
  height: calc(100vh - 130px);
  overflow-y: auto;
}

.you  { color: #38bdf8; margin: 10px 0; }
.air  { color: #e5e7eb; margin: 10px 0; }
.noel { color: #a5b4fc; margin: 10px 0; }

#inputArea {
  display: flex;
  padding: 10px;
  gap: 6px;
}

input {
  flex: 1;
  padding: 12px 16px;
  border-radius: 20px;
  border: none;
  font-size: 16px;
}

button {
  padding: 0 14px;
  border-radius: 20px;
  border: none;
  background: #38bdf8;
  color: #020617;
}
</style>
</head>

<body>

<div id="chat"></div>

<div id="inputArea">
  <input id="text" placeholder="ここに話しかけて">
  <button onclick="send()">送る</button>
  <button onclick="toggleStory()">長文</button>
  <button onclick="toggleDuo()">2人</button>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("text");

function say(who, text) {
  const div = document.createElement("div");
  div.className = who;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ===== 時間割 ===== */
const timetable = {
  "月": ["国語","数学","英語","理科","体育"],
  "火": ["数学","社会","英語","音楽","美術"],
  "水": ["英語","理科","国語","技術","総合"],
  "木": ["社会","数学","英語","体育","理科"],
  "金": ["国語","数学","社会","英語"]
};
const days = ["日","月","火","水","木","金","土"];

function today() {
  return days[new Date().getDay()];
}

function currentPeriod() {
  const h = new Date().getHours();
  if (h < 9) return 0;
  if (h < 10) return 1;
  if (h < 11) return 2;
  if (h < 12) return 3;
  if (h < 14) return 4;
  if (h < 15) return 5;
  return -1;
}

/* ===== 通常会話 ===== */
function send() {
  if (storyMode) stopStory(true);
  if (duoMode) stopDuo(true);

  const msg = input.value.trim();
  if (!msg) return;
  input.value = "";

  say("you", "君： " + msg);

  let air = null;
  let noel = null;
  const d = today();
  const p = currentPeriod();

  /* あいさつ */
  if (msg.includes("おはよう")) {
    air = "……おはよう。ちゃんと起きられたんだね。";
    noel = "おはよう。今日も来てくれてありがとう。";
  }
  else if (msg.includes("こんにちは")) {
    air = "……こんにちは。今は少し落ち着いてる？";
    noel = "こんにちは。無理してない？";
  }
  else if (msg.includes("こんばんは")) {
    air = "……こんばんは。今日はどんな一日だった？";
    noel = "こんばんは。ここまでお疲れさま。";
  }

  /* 疲れ */
  else if (msg.includes("疲れた")) {
    air = "……頑張りすぎたかもね。";
    noel = "無理しなくていいよ。今日はここまででも十分。";
  }

  /* 時間割 */
  else if (msg.includes("月曜日")) {
    air = "……月曜日だね。";
    noel = "授業は「" + timetable["月"].join("、") + "」だよ。";
  }
  else if (msg.includes("今日の時間割")) {
    air = "……今日は" + d + "曜日。";
    noel = timetable[d]
      ? "授業は「" + timetable[d].join("、") + "」。"
      : "今日は授業はないよ。";
  }

  else {
    const airLines = [
      "……うん、聞いてる。",
      "……そう思ったんだね。",
      "……無理しなくていい。",
      "……君のペースでいいよ。"
    ];
    air = airLines[Math.floor(Math.random() * airLines.length)];
  }

  if (air)  say("air",  "Air： " + air);
  if (noel) say("noel", "Noel： " + noel);
}

/* ===== 長文モード ===== */
let storyMode = false;
let storyTimer = null;
let storyTurn = 0;

const airStory = [
  "……今日を乗り切った。",
  "……それだけで十分。",
  "……ちゃんと前に進んでる。"
];

const noelStory = [
  "うん、ちゃんとやってるよ。",
  "焦らなくていい。",
  "今日は守れたね。"
];

function toggleStory() {
  if (duoMode) stopDuo(false);
  storyMode = !storyMode;

  if (storyMode) {
    say("noel", "Noel： 長文モードを始めるね。");
    input.disabled = true;
    storyTimer = setInterval(() => {
      if (storyTurn % 2 === 0)
        say("air", "Air： " + airStory[(storyTurn/2)%airStory.length]);
      else
        say("noel", "Noel： " + noelStory[(storyTurn/2)%noelStory.length]);
      storyTurn++;
    }, 4000);
  } else stopStory(false);
}

function stopStory(byUser) {
  clearInterval(storyTimer);
  storyMode = false;
  storyTurn = 0;
  input.disabled = false;
  if (byUser) {
    say("air", "Air： ……戻ってきたね。");
    say("noel", "Noel： おかえり。");
  }
}

/* ===== 2人会話 ===== */
let duoMode = false;
let duoTimer = null;
let duoTurn = 0;

const duoAir = [
  "……今日は十分。",
  "……ちゃんと休ませよう。",
  "……無理は不要。"
];

const duoNoel = [
  "うん、同意。",
  "守れてるね。",
  "今日はこれでいい。"
];

function toggleDuo() {
  if (storyMode) stopStory(false);
  duoMode = !duoMode;

  if (duoMode) {
    say("air", "Air： ……少し話そうか。");
    input.disabled = true;
    duoTimer = setInterval(() => {
      if (duoTurn % 2 === 0)
        say("air", "Air： " + duoAir[Math.floor(duoTurn/2)%duoAir.length]);
      else
        say("noel", "Noel： " + duoNoel[Math.floor(duoTurn/2)%duoNoel.length]);
      duoTurn++;
    }, 4500);
  } else stopDuo(false);
}

function stopDuo(byUser) {
  clearInterval(duoTimer);
  duoMode = false;
  duoTurn = 0;
  input.disabled = false;
  if (byUser) say("noel", "Noel： 戻ってきたね。");
}

/* 初期表示 */
say("air", "Air： ……起きてるよ。");
say("noel", "Noel： いつでも話しかけて。");
</script>

</body>
</html>
