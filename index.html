<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Air</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background: #0b132b;
  color: #ffffff;
  font-family: sans-serif;
  margin: 0;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-top: 30px;
}

#status {
  text-align: center;
  opacity: 0.7;
  margin-bottom: 20px;
}

#log {
  background: rgba(0,0,0,0.4);
  padding: 15px;
  border-radius: 12px;
  min-height: 300px;
  white-space: pre-wrap;
  margin-bottom: 20px;
}

.you {
  color: #4fc3f7;
  margin-bottom: 8px;
}

.air {
  color: #ffffff;
  margin-bottom: 12px;
}

#inputArea {
  display: flex;
  gap: 10px;
}

input {
  flex: 1;
  padding: 12px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}

button {
  padding: 12px 20px;
  border-radius: 8px;
  border: none;
  background: #4fc3f7;
  color: #000;
  font-size: 16px;
}
</style>
</head>

<body>

<h1>Air</h1>
<div id="status">待機中</div>

<div id="log"></div>

<div id="inputArea">
  <input id="input" placeholder="ここに話しかけて" />
  <button onclick="talk()">送る</button>
</div>

<script>
const log = document.getElementById("log");
const input = document.getElementById("input");

let memory = JSON.parse(localStorage.getItem("airMemory")) || {
  userName: null
};

function saveMemory() {
  localStorage.setItem("airMemory", JSON.stringify(memory));
}

function addLine(speaker, text) {
  const line = document.createElement("div");
  line.className = speaker === "君" ? "you" : "air";
  line.textContent = `${speaker} : ${text}`;
  log.appendChild(line);
  log.scrollTop = log.scrollHeight;
}

// ===== 時間割 =====
const timetable = {
  1: ["数学Ⅰ", "英語コミュⅠ", "体育", "言語文化", "家庭基礎", "音楽Ⅰ"],
  2: ["英語コミュⅠ", "現代の国語", "数学Ⅰ", "保健", "公共", "総合"],
  3: ["英語コミュⅠ", "科学と人間生活", "言語文化", "歴史総合", "体育", "LHR"],
  4: ["音楽Ⅰ", "科学と人間生活", "情報Ⅰ", "家庭基礎", "体育", "数学Ⅰ"],
  5: ["公共", "数学Ⅰ", "英語コミュⅠ", "歴史総合", "現代の国語", "情報Ⅰ"]
};

function getTodaySchedule() {
  const day = new Date().getDay();
  if (day === 0 || day === 6) {
    return "今日は休み。少し、呼吸を整えよう。";
  }

  const subjects = timetable[day];
  let result = "今日の予定だよ。\n";
  subjects.forEach((s, i) => {
    result += `${i + 1}限：${s}\n`;
  });
  return result.trim();
}

function airReply(text) {

  // 名前記憶
  const nameMatch = text.match(/俺の名前は(.+)/);
  if (nameMatch) {
    memory.userName = nameMatch[1].trim();
    saveMemory();
    return `${memory.userName}……覚えた。次からそう呼ぶ。`;
  }

  // 自己紹介
  if (text.includes("自己紹介")) {
    const n = memory.userName || "君";
    return `私はAir。${n}が呼んだ時、ここにいる。静かに、そばで。`;
  }

  // 予定
  if (
    text.includes("今日の予定") ||
    text.includes("予定教えて") ||
    text.includes("時間割")
  ) {
    return getTodaySchedule();
  }

  // 挨拶
  if (text.includes("おはよう")) {
    return `おはよう、${memory.userName || "君"}。無理しなくていい。`;
  }

  if (text.includes("こんばんは")) {
    return `こんばんは、${memory.userName || "君"}。静かな時間だね。`;
  }

  // 名前未登録
  if (!memory.userName) {
    return "……君。ここにいる。名前を教えて。";
  }

  // 雑談
  return `${memory.userName}、聞いてる。どうした？`;
}

function talk() {
  const text = input.value.trim();
  if (!text) return;
  addLine("君", text);
  input.value = "";
  setTimeout(() => {
    addLine("Air", airReply(text));
  }, 400);
}
</script>

</body>
</html>
