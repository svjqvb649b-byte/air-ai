<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Air</title>

<style>
body {
  margin: 0;
  background: #0b1220;
  color: white;
  font-family: system-ui;
}

.container {
  padding: 20px;
  max-width: 600px;
  margin: auto;
}

.title {
  text-align: center;
  font-size: 42px;
  margin-top: 20px;
}

.status {
  text-align: center;
  opacity: 0.7;
  margin-bottom: 20px;
}

.chat {
  background: rgba(0,0,0,0.3);
  border-radius: 16px;
  padding: 16px;
  min-height: 50vh;
  overflow-y: auto;
}

.you {
  color: #4fc3f7;
  margin-bottom: 6px;
}

.air {
  margin-bottom: 14px;
}

.input-area {
  display: flex;
  gap: 10px;
  margin-top: 16px;
}

input {
  flex: 1;
  padding: 12px;
  border-radius: 20px;
  border: none;
  outline: none;
}

button {
  padding: 12px 18px;
  border-radius: 20px;
  border: none;
  background: #4fc3f7;
  font-weight: bold;
}
</style>
</head>

<body>
<div class="container">
  <div class="title">Air</div>
  <div class="status">待機中</div>

  <div class="chat" id="chat"></div>

  <div class="input-area">
    <input id="input" placeholder="ここに話しかけて">
    <button onclick="send()">送る</button>
  </div>
</div>

<script>
const periods = [
  { name: "1限", start: "08:50", end: "09:40" },
  { name: "2限", start: "09:50", end: "10:40" },
  { name: "3限", start: "10:50", end: "11:40" },
  { name: "4限", start: "11:50", end: "12:40" },
  { name: "昼休み", start: "12:40", end: "13:25" },
  { name: "5限", start: "13:25", end: "14:15" },
  { name: "6限", start: "14:25", end: "15:15" }
];

const timetable = {
  1: {1:"数学",2:"英語コミュ",3:"体育",4:"言語文化",5:"家庭基礎",6:"なし"},
  2: {1:"英語コミュ",2:"現代の国語",3:"数学",4:"保健",5:"公共",6:"なし"},
  3: {1:"英語コミュ",2:"科学と人間生活",3:"言語文化",4:"歴史総合",5:"なし",6:"なし"},
  4: {1:"音楽",2:"科学と人間生活",3:"情報Ⅰ",4:"家庭基礎",5:"なし",6:"なし"},
  5: {1:"公共",2:"数学Ⅰ",3:"英語コミュ",4:"歴史総合",5:"現代の国語",6:"なし"}
};

function nowMinutes() {
  const d = new Date();
  return d.getHours() * 60 + d.getMinutes();
}

function toMin(t) {
  const [h,m] = t.split(":").map(Number);
  return h * 60 + m;
}

function getCurrentPeriod() {
  const now = nowMinutes();
  return periods.find(p => now >= toMin(p.start) && now <= toMin(p.end));
}

function getNextPeriod() {
  const now = nowMinutes();
  return periods.find(p => now < toMin(p.start));
}

function reply(text) {
  const chat = document.getElementById("chat");
  chat.innerHTML += `<div class="air">Air: ${text}</div>`;
  chat.scrollTop = chat.scrollHeight;
}

function send() {
  const input = document.getElementById("input");
  const text = input.value.trim();
  if (!text) return;

  const chat = document.getElementById("chat");
  chat.innerHTML += `<div class="you">君: ${text}</div>`;

  const day = new Date().getDay();
  const today = timetable[day];

  if (text.includes("疲れ")) {
    reply("……少し休もう。無理は、よくない。");
  }

  else if (text.includes("自己紹介") || text.includes("君は誰")) {
    reply("私はAir。君の時間割と日常を静かに見ている。必要な時に呼んで。");
  }

  else if (text.includes("暇")) {
    reply("……そう。なら、少し話そう。");
  }

  else if (text.includes("元気")) {
    reply("問題ない。君は？");
  }

  else if (text.includes("次")) {
    const next = getNextPeriod();
    if (!next) {
      reply("今日はもう終わり。おつかれさま。");
    } else if (next.name === "昼休み") {
      reply("次は昼休み。落ち着いて。");
    } else {
      const num = Number(next.name[0]);
      reply(`次は${next.name}。${today[num] ?? "授業なし"}。`);
    }
  }

  else if (text.includes("今")) {
    const cur = getCurrentPeriod();
    if (!cur) {
      reply("今は授業時間じゃない。");
    } else if (cur.name === "昼休み") {
      reply("今は昼休み。");
    } else {
      const num = Number(cur.name[0]);
      reply(`今は${cur.name}。${today[num] ?? "授業なし"}。`);
    }
  }

  else {
    reply("……うん。聞いてる。");
  }

  input.value = "";
}
</script>
</body>
</html>
