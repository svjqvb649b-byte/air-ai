<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Air</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  background: #0b1220;
  color: white;
  font-family: system-ui;
}
.container { padding: 20px; }
.title { text-align: center; font-size: 40px; margin-top: 20px; }
.status { text-align: center; opacity: 0.7; margin-bottom: 20px; }
.chat {
  background: rgba(0,0,0,0.3);
  border-radius: 16px;
  padding: 20px;
  min-height: 260px;
}
.you { color: #4fc3f7; margin-bottom: 5px; }
.air { margin-bottom: 15px; }
.input-area { display: flex; gap: 10px; margin-top: 20px; }
input {
  flex: 1; padding: 12px;
  border-radius: 20px; border: none; outline: none;
}
button {
  padding: 12px 18px;
  border-radius: 20px;
  border: none;
  background: #4fc3f7;
  font-weight: bold;
}
</style>
</head>

<body>
<div class="container">
  <div class="title">Air</div>
  <div class="status">待機中</div>
  <div class="chat" id="chat"></div>

  <div class="input-area">
    <input id="input" placeholder="ここに話しかけて">
    <button onclick="send()">送る</button>
  </div>
</div>

<script>
/* ===== 授業時間 ===== */
const periods = [
  { name: "1限", start: "08:50", end: "09:40" },
  { name: "2限", start: "09:50", end: "10:40" },
  { name: "3限", start: "10:50", end: "11:40" },
  { name: "4限", start: "11:50", end: "12:40" },
  { name: "昼休み", start: "12:40", end: "13:25" },
  { name: "5限", start: "13:25", end: "14:15" },
  { name: "6限", start: "14:25", end: "15:15" }
];

/* ===== 部活 ===== */
const club = { start: "16:00", end: "18:00" };

/* ===== 時間割 ===== */
const timetable = {
  1:{1:"数学",2:"英語",3:"体育",4:"言語文化",5:"家庭科",6:"なし"},
  2:{1:"英語",2:"現国",3:"数学",4:"保健",5:"公共",6:"なし"},
  3:{1:"英語",2:"理科",3:"言語文化",4:"歴史",5:"数学",6:"なし"},
  4:{1:"音楽",2:"理科",3:"情報",4:"家庭科",5:"英語",6:"なし"},
  5:{1:"公共",2:"数学",3:"英語",4:"歴史",5:"現国",6:"なし"}
};

/* ===== 時刻処理 ===== */
function toMin(t){
  const [h,m]=t.split(":").map(Number);
  return h*60+m;
}
function nowMin(){
  const d=new Date();
  return d.getHours()*60+d.getMinutes();
}
function getCurrentPeriod(){
  const n=nowMin();
  return periods.find(p=>n>=toMin(p.start)&&n<=toMin(p.end));
}
function isClubTime(){
  const n=nowMin();
  return n>=toMin(club.start)&&n<=toMin(club.end);
}

/* ===== 曜日判定 ===== */
function getTargetDay(text){
  const t=new Date().getDay();
  if(text.includes("明日")) return (t+1)%7;
  if(text.includes("明後日")) return (t+2)%7;
  const m={"日":0,"月":1,"火":2,"水":3,"木":4,"金":5,"土":6};
  for(const k in m) if(text.includes(k)) return m[k];
  return t;
}

/* ===== Air発話 ===== */
function reply(text){
  const c=document.getElementById("chat");
  c.innerHTML+=`<div class="air">Air：${text}</div>`;
  c.scrollTop=c.scrollHeight;
}

/* ===== Airが質問 ===== */
function maybeAsk(){
  const q=[
    "……今日は眠い？",
    "授業、ついていけてる？",
    "放課後は部活？",
    "今、少し疲れてる？"
  ];
  if(Math.random()<0.35){
    reply(q[Math.floor(Math.random()*q.length)]);
  }
}

/* ===== メイン ===== */
function send(){
  const i=document.getElementById("input");
  const t=i.value;
  if(!t) return;

  const c=document.getElementById("chat");
  c.innerHTML+=`<div class="you">君：${t}</div>`;

  /* 感謝 */
  if(
    t.includes("ありがとう") ||
    t.includes("ありがと") ||
    t.includes("助かった") ||
    t.includes("サンキュー")
  ){
    reply("……どういたしまして。役に立てたならよかった。");
    maybeAsk();
  }

  /* 疲れ */
  else if(t.includes("疲")){
    reply("……無理しないで。休むのも大事。");
    maybeAsk();
  }

  /* 今 */
  else if(t.includes("今")){
    if(isClubTime()){
      reply("今は部活の時間。集中したほうがいい。");
    }else{
      const p=getCurrentPeriod();
      if(!p) reply("今は授業時間じゃない。");
      else if(p.name==="昼休み") reply("今は昼休み。");
      else{
        const d=timetable[new Date().getDay()];
        reply(`今は${p.name}。${d[p.name[0]]}。`);
      }
    }
    maybeAsk();
  }

  /* 次 */
  else if(t.includes("次")){
    if(nowMin()<toMin(club.start)&&nowMin()>toMin("15:15")){
      reply("次は部活。16時から。");
    }else{
      reply("次は特に予定はない。");
    }
    maybeAsk();
  }

  /* 予定 */
  else if(t.includes("予定")||t.includes("授業")){
    const d=getTargetDay(t);
    const name=["日","月","火","水","木","金","土"][d];
    const data=timetable[d];
    if(!data){
      reply(`${name}曜日は休み。`);
    }else{
      let r=`${name}曜日の予定：`;
      for(let i=1;i<=6;i++) r+=`${i}限 ${data[i]} / `;
      r+=`放課後は部活（16:00〜18:00）`;
      reply(r);
    }
  }

  /* 自己紹介 */
  else if(t.includes("自己紹介")){
    reply("私はAir。君の学校生活を、静かに支える存在。");
  }

  /* デフォルト */
  else{
    reply("……うん。聞いてる。");
    maybeAsk();
  }

  i.value="";
}
</script>
</body>
</html>
