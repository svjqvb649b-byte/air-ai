<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Air & Noel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #020617;
  color: #e5e7eb;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

#chat {
  padding: 16px;
  height: calc(100vh - 80px);
  overflow-y: auto;
}

.you { color: #38bdf8; margin: 10px 0; }
.air { color: #e5e7eb; margin: 10px 0; }
.noel { color: #a5b4fc; margin: 10px 0; }

#inputArea {
  display: flex;
  padding: 10px;
}

input {
  flex: 1;
  padding: 12px 16px;
  border-radius: 20px;
  border: none;
  font-size: 16px;
}

button {
  margin-left: 8px;
  padding: 0 18px;
  border-radius: 20px;
  border: none;
  background: #38bdf8;
  color: #020617;
  font-size: 16px;
}
</style>
</head>

<body>
<div id="chat"></div>

<div id="inputArea">
  <input id="text" placeholder="ここに話しかけて">
  <button onclick="send()">送る</button>
</div>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("text");

/* ===== 表示 ===== */
function say(who, text) {
  const div = document.createElement("div");
  div.className = who;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ===== 時間割（1-1）===== */
const timetable = {
  1: ["数学Ⅰ", "英語コミュⅠ", "体育", "言語文化", "家庭基礎", "音楽Ⅰ"],
  2: ["英語コミュⅠ", "現代の国語", "数学Ⅰ", "保健", "公共", "総合"],
  3: ["英語コミュⅠ", "科学と人間生活", "言語文化", "歴史総合", "体育", "LHR"],
  4: ["音楽Ⅰ", "科学と人間生活", "情報Ⅰ", "家庭基礎", "体育", "数学Ⅰ"],
  5: ["公共", "数学Ⅰ", "英語コミュⅠ", "歴史総合", "現代の国語", "情報Ⅰ"]
};

const dayNames = ["日","月","火","水","木","金","土"];

/* ===== 時間設定 ===== */
const periods = [
  { name: "1限目", start: "08:50", end: "09:40" },
  { name: "2限目", start: "09:50", end: "10:40" },
  { name: "3限目", start: "10:50", end: "11:40" },
  { name: "4限目", start: "12:50", end: "13:40" },
  { name: "昼休み", start: "13:40", end: "14:20" },
  { name: "5限目", start: "14:25", end: "15:15" },
  { name: "6限目", start: "15:15", end: "16:00" }
];

function nowPeriod() {
  const now = new Date();
  const t = now.getHours() * 60 + now.getMinutes();

  for (let i = 0; i < periods.length; i++) {
    const [sh, sm] = periods[i].start.split(":").map(Number);
    const [eh, em] = periods[i].end.split(":").map(Number);
    if (t >= sh*60+sm && t < eh*60+em) return i;
  }
  return -1;
}

/* ===== モード管理 ===== */
let duoMode = false;
let idleTimer = null;
let duoTimer = null;
let turn = 0;

/* ===== セリフ ===== */
const duoAir = [
  "……今日は落ち着いてる。",
  "……時間、ちゃんと進んでる。",
  "……大丈夫そう。"
];

const duoNoel = [
  "うん、いい流れ。",
  "無理してないね。",
  "このままでいいよ。"
];

const idleAir = [
  "……静かだね。",
  "……待ってる。",
  "……考え中。"
];

const idleNoel = [
  "今はゆっくりでいいよ。",
  "話したくなったら呼んで。",
  "ここにいるからね。"
];

/* ===== 2人会話 ===== */
function startDuo() {
  stopDuo();
  duoMode = true;
  say("air","Air : ……少し話そう。");
  duoTimer = setInterval(() => {
    const i = Math.floor(turn / 2);
    if (turn % 2 === 0)
      say("air","Air : " + duoAir[i % duoAir.length]);
    else
      say("noel","Noel : " + duoNoel[i % duoNoel.length]);
    turn++;
  }, 4500);
}

function stopDuo() {
  clearInterval(duoTimer);
  duoMode = false;
  turn = 0;
}

/* ===== 無操作自動会話 ===== */
function resetIdle() {
  clearTimeout(idleTimer);
  idleTimer = setTimeout(() => {
    if (!duoMode) startDuo();
  }, 20000);
}

/* ===== 時間割表示 ===== */
function showToday() {
  const d = new Date();
  const day = d.getDay();
  const list = timetable[day];
  if (!list) {
    say("air","Air : ……今日は授業ない日。");
    say("noel","Noel : 休めるね。");
    return;
  }
  say("air",`Air : ……今日は${dayNames[day]}曜日。`);
  say("noel","Noel : 時間割は「" + list.join("、") + "」。");
}

/* ===== 次は何限？ ===== */
function showNext() {
  const d = new Date();
  const day = d.getDay();
  const list = timetable[day];
  if (!list) {
    say("air","Air : ……今日は授業ない。");
    return;
  }
  const p = nowPeriod();
  if (p === -1 || periods[p].name === "昼休み") {
    say("air","Air : ……今は授業時間じゃない。");
    return;
  }
  say("air",`Air : ……今は${periods[p].name}。`);
  say("noel",`Noel : 教科は「${list[p]}」だよ。`);
}

/* ===== 送信 ===== */
function send() {
  const msg = input.value.trim();
  if (!msg) return;
  input.value = "";
  resetIdle();
  stopDuo();

  say("you","君 : " + msg);

  if (msg.includes("2人で")) { startDuo(); return; }
  if (msg.includes("時間割") || msg.includes("今日の授業")) { showToday(); return; }
  if (msg.includes("次は何限")) { showNext(); return; }

  if (msg.includes("おはよう")) {
    say("air","Air : ……おはよう。");
    say("noel","Noel : 今日も一緒にいこう。");
    return;
  }

  if (msg.includes("こんにちは")) {
    say("air","Air : ……こんにちは。");
    say("noel","Noel : 調子どう？");
    return;
  }

  say("air","Air : ……うん、聞いてる。");
}

/* ===== 初期 ===== */
say("air","Air : ……ここにいる。");
say("noel","Noel : いつでも話しかけて。");
resetIdle();
</script>
</body>
</html>
